import React from 'react'
import { Link } from 'react-router-dom'
import Nav from 'react-bootstrap/Nav';
import { useLocation } from 'react-router-dom';
import { useState } from 'react';
import { useEffect } from 'react';
import axios from 'axios';
import { toast } from 'react-toastify';

export default function Viewcommodity() 
{
    const location = useLocation(); // Get current location
    const [activeKey, setActiveKey] = useState(location.pathname);
    const[commoditylist,setCommoditylist]=useState([]);  //Display commodity details
    const[citylist,setCitylist]=useState([]); //Dropdown list of cities
    const[selectedcity,setSelectedcity]=useState('');
  
    useEffect(() => {
      setActiveKey(location.pathname); // Update active key when location changes
      getallcity();  // Fetch commodities when a city is selected
  }, [location]);


  useEffect(() => {
    if (selectedcity) {
        getcommodity(); // Fetch commodities when a city is selected
    }
}, [selectedcity]);

  function getcommodity()    //Display Commodity Details
  {
    axios
      .get(`http://localhost:8080/getcommodity/${selectedcity}`)
      .then((res)=>{
          setCommoditylist(res.data);
      })
      .catch((err)=>{
          toast.error(err.response.data);
      });
  }


  function getallcity() //Dropdown list of City
  {
    axios
      .get("http://localhost:8080/getallcity")
      .then((res)=>{
          setCitylist(res.data);
      })
      .catch((err)=>{
          toast.error(err.response.data);
      });
  }

  return (
    <>
    <div>
           <Nav
               variant="tabs"
               activeKey={activeKey}
               onSelect={setActiveKey}
               style={{
                   height: "100px",
                   textAlign: "center",
                   background: "maroon",
               }}
           >
               <Nav.Item>
                   <Nav.Link
                     as={Link} // Use Link for navigation
                     to="/Postcomplaints" // Define the route
                       eventKey="/Postcomplaints"
                       style={{
                         color: activeKey === "/Postcomplaints" ? "maroon" : "pink",
                           fontWeight: "bold",
                           fontSize: "18px",
                           fontStyle: "oblique",
                           marginTop: "51px",
                           marginLeft: "5px"
                       }}
                   >
                       Postcomplaints
                   </Nav.Link>
               </Nav.Item>
               <Nav.Item>
                   <Nav.Link
                   as={Link} // Use Link for navigation
                   to="/Viewcomplaintstatus" // Define the route
                       eventKey="/Viewcomplaintstatus"
                       style={{
                         color: activeKey === '/Viewcomplaintstatus' ? "maroon" : "pink",
                           fontWeight: "bold",
                           fontSize: "18px",
                           fontStyle: "oblique",
                           marginTop: "51px",
                           marginLeft: "0px"
                       }}
                   >
                       Viewcompstatus
                   </Nav.Link>
               </Nav.Item>
               <Nav.Item>
                   <Nav.Link
                   as={Link} // Use Link for navigation
                   to="/Searchbycategory" // Define the route
                       eventKey="/Searchbycategory"
                       style={{
                         color: activeKey === '/Searchbycategory' ? "maroon" : "pink",
                           fontWeight: "bold",
                           fontSize: "18px",
                           fontStyle: "oblique",
                           marginTop: "51px",
                           marginLeft: "0px"
                       }}
                   >
                       Searchbycategory
                   </Nav.Link>
               </Nav.Item>
               <Nav.Item>
                   <Nav.Link
                   as={Link} // Use Link for navigation
                   to="/Viewnews" // Define the route
                       eventKey="/Viewnews"
                       style={{
                         color: activeKey === '/Viewnews' ? "maroon" : "pink",
                           fontWeight: "bold",
                           fontSize: "18px",
                           fontStyle: "oblique",
                           marginTop: "51px",
                           marginLeft: "0px"
                       }}
                   >
                       Viewnews
                   </Nav.Link>
               </Nav.Item>
               <Nav.Item>
                   <Nav.Link
                    as={Link} // Use Link for navigation
                    to="/Viewagrioffice" // Define the route
                       eventKey="/Viewagrioffice"
                       style={{
                           color: activeKey === '/Viewagrioffice' ? "maroon" : "pink",
                           fontWeight: "bold",
                           fontSize: "18px",
                           fontStyle: "oblique",
                           marginTop: "51px",
                           marginLeft: "0px",
                           width: "150px"
                       }}
                   >
                       ViewOffice
                   </Nav.Link>
               </Nav.Item>
               <Nav.Item>
                   <Nav.Link
                    as={Link} // Use Link for navigation
                    to="/Postfeedback" // Define the route
                       eventKey="/Postfeedback"
                       style={{
                           color: activeKey === '/Postfeedback' ? "maroon" : "pink",
                           fontWeight: "bold",
                           fontSize: "18px",
                           fontStyle: "oblique",
                           marginTop: "51px",
                           marginLeft: "0px",
                           width: "150px"
                       }}
                   >
                       Postfeedback
                   </Nav.Link>
               </Nav.Item>
               <Nav.Item>
                   <Nav.Link
                    as={Link} // Use Link for navigation
                    to="/Viewcommodity" // Define the route
                       eventKey="/Viewcommodity"
                       style={{
                           color: activeKey === '/Viewcommodity' ? "maroon" : "pink",
                           fontWeight: "bold",
                           fontSize: "18px",
                           fontStyle: "oblique",
                           marginTop: "51px",
                           marginLeft: "0px",
                           width: "157px"
                       }}
                   >
                       Viewcommodity
                   </Nav.Link>
               </Nav.Item>
               <Nav.Item>
                   <Nav.Link
                    as={Link} // Use Link for navigation
                    to="/UpdateProfile" // Define the route
                       eventKey="/UpdateProfile"
                       style={{
                           color: activeKey === '/UpdateProfile' ? "maroon" : "pink",
                           fontWeight: "bold",
                           fontSize: "18px",
                           fontStyle: "oblique",
                           marginTop: "51px",
                           marginLeft: "0px",
                           width: "150px"
                       }}
                   >
                       UpdateProfile
                   </Nav.Link>
               </Nav.Item>
   
               <h1 style={{color:"white",marginLeft:"-500px",marginTop:"5px"}}>Farmer Dashboard</h1>
           </Nav>
           </div>  
           <Link to="/" ><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ9FbkEt8EWDLyJwqQ80JvC9klbXTQJ-qGX6QzuBSvcN1kbg7xa8725OkrAaOO734wog-E&usqp=CAU" alt="backimg" width="50px"/></Link>


           <h1 style={{color:"Red",marginLeft:"500px"}}>View Commodity Details</h1>
           <div className='registerpage'>
            <label className='form-label'>Select City:</label>
            <select className="form-select" value={selectedcity} onChange={(e)=>setSelectedcity(e.target.value)}>
                <option key={0}>--Choose Options--</option>
                {
                    citylist.map((item,index)=>(
                        <option key={index} value={item.cityid}>{item.cityid}-{item.city}</option>
                    ))
                }
            </select>
            </div>

         <div className='table3'>
        <table className='table table-striped'>
        <thead>
            <tr>
                <th>Commodity id</th>
                <th>Commodity Name</th>
                <th>Price</th>
                <th>city Name</th>
                <th>State Name</th>
            </tr>
            </thead>  
            <tbody>
             {
                commoditylist.map((item,index)=>(
                    <tr key={index}>
                        <td>{item.commodityid}</td>
                        <td>{item.commodity}</td>
                        <td>{item.price}</td>
                        <td>{item.city2?.city}</td>
                        <td>{item.city2.state1?.state}</td>
                    </tr>
                ))
             }
                </tbody>          
        </table>
        </div>                    
    </>
  )
}
